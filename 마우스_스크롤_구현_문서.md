# 마우스 스크롤 기능 구현 문서 (커밋 6f8a9c24)

## 📋 개요
- **커밋**: 6f8a9c24cb34955073021ebfe6576d4775cfd6fb
- **작성자**: bougs93 <happyreport@gmail.com>
- **날짜**: 2025년 10월 14일
- **제목**: fix: 마우스 오른쪽, 스크롤 구현.

## 🎯 구현 목표
Syncfusion DataGrid에서 마우스 오른쪽 버튼 드래그와 두 손가락 터치 드래그를 통한 스크롤 기능 구현

## 🔧 주요 변경사항

### 1. **DataGridController 추가**
```dart
// SfDataGrid 컨트롤러 (제스처 스크롤용)
final DataGridController _dataGridController = DataGridController();
```

### 2. **기존 ScrollController 방식에서 DataGridController 방식으로 변경**

#### **이전 방식 (ScrollController)**
- `_horizontalScrollController.jumpTo()` 사용
- `_verticalScrollController.jumpTo()` 사용
- 복잡한 스크롤 위치 계산 및 제한

#### **새로운 방식 (DataGridController)**
- `_dataGridController.scrollToRow()` 사용
- `_dataGridController.scrollToColumn()` 사용
- 행/열 인덱스 기반의 간단한 스크롤

## 🖱️ 마우스 오른쪽 버튼 스크롤 구현

### **이벤트 처리**
```dart
onPointerDown: (event) {
  if (event.buttons == kSecondaryMouseButton) {
    _rightClickDragStart = event.position;
    ref.read(scrollProvider.notifier).setScrolling(true);
    AppLogger.exchangeDebug('마우스 오른쪽 버튼 드래그 시작: ${event.position}');
  }
}
```

### **스크롤 계산 로직**
```dart
onPointerMove: (event) {
  if (event.buttons == kSecondaryMouseButton && _rightClickDragStart != null) {
    final delta = event.position - _rightClickDragStart!;
    
    // 델타를 행/열 인덱스로 변환하여 스크롤
    final zoomFactor = ref.read(zoomFactorProvider);
    final rowHeight = AppConstants.dataRowHeight * zoomFactor;
    final columnWidth = AppConstants.periodColumnWidth * zoomFactor;
    
    // 스크롤할 행/열 수 계산 (델타의 반대 방향으로 스크롤)
    final scrollRows = (-delta.dy / rowHeight).round();
    final scrollColumns = (-delta.dx / columnWidth).round();
    
    // DataGridController를 통한 스크롤 실행
    if (scrollRows != 0) {
      _dataGridController.scrollToRow(scrollRows.toDouble());
    }
    if (scrollColumns != 0) {
      _dataGridController.scrollToColumn(scrollColumns.toDouble());
    }
  }
}
```

## 📱 두 손가락 터치 스크롤 구현

### **이벤트 처리**
```dart
onScaleStart: (details) {
  if (details.pointerCount == 2) {
    _rightClickDragStart = details.focalPoint;
    ref.read(scrollProvider.notifier).setScrolling(true);
    AppLogger.exchangeDebug('두 손가락 드래그 시작: ${details.focalPoint}');
  }
}
```

### **스크롤 계산 로직**
```dart
onScaleUpdate: (details) {
  if (details.pointerCount == 2 && _rightClickDragStart != null) {
    final delta = details.focalPoint - _rightClickDragStart!;
    
    // 마우스 오른쪽 버튼과 동일한 로직 사용
    final zoomFactor = ref.read(zoomFactorProvider);
    final rowHeight = AppConstants.dataRowHeight * zoomFactor;
    final columnWidth = AppConstants.periodColumnWidth * zoomFactor;
    
    final scrollRows = (-delta.dy / rowHeight).round();
    final scrollColumns = (-delta.dx / columnWidth).round();
    
    if (scrollRows != 0) {
      _dataGridController.scrollToRow(scrollRows.toDouble());
    }
    if (scrollColumns != 0) {
      _dataGridController.scrollToColumn(scrollColumns.toDouble());
    }
  }
}
```

## 🎨 SfDataGrid 연결

### **Controller 연결**
```dart
SfDataGrid(
  // ... 기타 속성들
  controller: _dataGridController,  // DataGridController 연결
)
```

## 📊 스크롤 계산 공식

### **행 스크롤 계산**
```
scrollRows = (-delta.dy / rowHeight).round()
```
- `delta.dy`: 마우스 드래그의 세로 이동 거리
- `rowHeight`: 행 높이 (줌 팩터 적용)
- 음수 처리로 자연스러운 스크롤 방향 구현

### **열 스크롤 계산**
```
scrollColumns = (-delta.dx / columnWidth).round()
```
- `delta.dx`: 마우스 드래그의 가로 이동 거리
- `columnWidth`: 열 너비 (줌 팩터 적용)
- 음수 처리로 자연스러운 스크롤 방향 구현

## 🔄 셀 중앙 스크롤 기능

### **구현 방식**
```dart
void scrollToCellCenter(String teacherName, String day, int period) {
  // ... 교사 및 컬럼 인덱스 찾기 로직
  
  // DataGridController를 통한 스크롤 실행
  try {
    _dataGridController.scrollToRow(teacherIndex.toDouble());
    _dataGridController.scrollToColumn(columnIndex.toDouble());
    
    AppLogger.exchangeDebug('DataGridController 스크롤 실행: 교사idx: $teacherIndex, 컬럼idx: $columnIndex');
  } catch (e) {
    AppLogger.exchangeDebug('DataGridController 스크롤 실패: $e');
    // 백업 스크롤 방법 (기존 ScrollController 사용)
  }
}
```

## 🎯 핵심 특징

### **1. 자연스러운 스크롤 방향**
- 드래그 방향과 반대로 스크롤 (마우스 패드처럼)
- 음수 델타 처리로 직관적인 사용자 경험

### **2. 줌 팩터 지원**
- `zoomFactor`를 고려한 행/열 크기 계산
- 확대/축소 상태에서도 정확한 스크롤

### **3. 로깅 시스템**
- 모든 스크롤 동작에 대한 상세한 로그
- 디버깅 및 문제 해결 용이

### **4. 백업 시스템**
- DataGridController 실패 시 기존 ScrollController 사용
- 안정적인 스크롤 기능 보장

## 📝 사용법

### **마우스 오른쪽 버튼 스크롤**
1. 마우스 오른쪽 버튼을 누른 상태로 드래그
2. 드래그 방향과 반대로 시간표가 스크롤됨

### **두 손가락 터치 스크롤**
1. 두 손가락으로 화면을 드래그
2. 드래그 방향과 반대로 시간표가 스크롤됨

## 🔍 장점

1. **간단한 구현**: DataGridController의 내장 메서드 활용
2. **정확한 스크롤**: 행/열 단위의 정확한 스크롤
3. **성능 최적화**: Syncfusion의 최적화된 스크롤 엔진 사용
4. **크로스 플랫폼**: 마우스와 터치 모두 지원
5. **줌 지원**: 확대/축소 상태에서도 정상 동작

## 🚀 결론

이 구현은 Syncfusion DataGrid의 DataGridController를 활용하여 간단하고 효율적인 마우스 스크롤 기능을 제공합니다. 기존의 복잡한 ScrollController 방식에서 벗어나 더 직관적이고 안정적인 스크롤 경험을 사용자에게 제공합니다.
