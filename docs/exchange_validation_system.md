# ì‹œê°„í‘œ êµì²´ ì‹œìŠ¤í…œ ê²€ì¦ ë¬¸ì„œ

ì´ì „ íŒŒì¼ì— ì¸ì½”ë”© ë¬¸ì œê°€ ìˆì—ˆìœ¼ë¯€ë¡œ ë‹¤ì‹œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ êµì²´ ì‹œìŠ¤í…œ ê°œìš”](#ì „ì²´-êµì²´-ì‹œìŠ¤í…œ-ê°œìš”)
2. [êµì²´ ë¶ˆê°€ ì…€ ê´€ë¦¬](#êµì²´-ë¶ˆê°€-ì…€-ê´€ë¦¬)
3. [êµì²´ ìœ í˜•ë³„ ê²€ì¦ ê³¼ì •](#êµì²´-ìœ í˜•ë³„-ê²€ì¦-ê³¼ì •)
4. [ê²€ì¦ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸](#ê²€ì¦-ì•Œê³ ë¦¬ì¦˜-ìƒì„¸)
5. [ì„±ëŠ¥ ë° ìµœì í™”](#ì„±ëŠ¥-ë°-ìµœì í™”)
6. [ë¬¸ì„œ ì—°ê³„](#ë¬¸ì„œ-ì—°ê³„)

---

## ì „ì²´ êµì²´ ì‹œìŠ¤í…œ ê°œìš”

### êµì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    êµì²´ ê´€ë¦¬ ì‹œìŠ¤í…œ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NonExchangeableManager (êµì²´ ë¶ˆê°€ ì…€ ê´€ë¦¬)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ExchangeServiceâ”‚  â”‚CircularExch â”‚  â”‚ ChainExch    â”‚           â”‚
â”‚  â”‚   (1:1 êµì²´)  â”‚  â”‚Service      â”‚  â”‚Service       â”‚           â”‚
â”‚  â”‚              â”‚  â”‚ (ìˆœí™˜êµì²´)   â”‚  â”‚ (ì—°ì‡„êµì²´)    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ExchangePath ì¸í„°í˜ì´ìŠ¤                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚OneToOneExchP â”‚  â”‚CircularExchP â”‚  â”‚ ChainExchP   â”‚           â”‚
â”‚  â”‚            thâ”‚  â”‚ath          â”‚  â”‚ath           â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµì²´ ë¶ˆê°€ ê²€ì‚¬ í†µí•© ì²´ê³„

**ê¸°ë³¸ ê²€ì‚¬ ì¡°ê±´:**
- `TimeSlot.isExchangeable` = true (êµì²´ ê°€ëŠ¥ ë§ˆí¬)
- `TimeSlot.isNotEmpty` = true (ì‹¤ì œ ìˆ˜ì—…ì´ ìˆëŠ” ìŠ¬ë¡¯)
- êµì²´ ë¶ˆê°€ ë§ˆí¬ëœ ì‹œê°„ëŒ€ë¡œ êµì‚¬ ì´ë™ ê¸ˆì§€

**ê³µí†µ ê²€ì¦ í´ë˜ìŠ¤:**
```dart
class NonExchangeableManager {
  bool isNonExchangeableTimeSlot(String teacherName, String day, int period) {
    // í•´ë‹¹ êµì‚¬ê°€ í•´ë‹¹ ì‹œê°„ëŒ€ì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
    return !timeSlot.isExchangeable && timeSlot.exchangeReason == 'êµì²´ë¶ˆê°€';
  }
}
```

---

## êµì²´ ë¶ˆê°€ ì…€ ê´€ë¦¬

### TimeSlot ëª¨ë¸ì˜ êµì²´ ë¶ˆê°€ ê²€ì‚¬ ì†ì„±

```dart
class TimeSlot {
  String? teacher;           // êµì‚¬ëª…            
  String? subject;          // ê³¼ëª©ëª…  
  String? className;        // í•™ê¸‰ëª…
  bool isExchangeable;      // êµì²´ ê°€ëŠ¥ ì—¬ë¶€
  String? exchangeReason;   // êµì²´ ë¶ˆê°€ ì‚¬ìœ 
  
  /// êµì²´ ê°€ëŠ¥ ì—¬ë¶€ ì¢…í•© íŒë‹¨
  bool get canExchange => isExchangeable && isNotEmpty;
  
  /// í‘œì‹œìš© ë¬¸ìì—´
  String get displayText => '${className ?? ''}\n${subject ?? ''}';
}
```

### êµì²´ ë¶ˆê°€ ì‚¬ìœ  ì¢…ë¥˜

| ì‚¬ìœ  ì½”ë“œ | ì„¤ëª… | ì˜ˆì‹œ |
|-----------|------|------|
| `"ê°™ì€ í•™ê¸‰"` | ê°™ì€ í•™ê¸‰ ë‚´ ì¤‘ë³µ êµì²´ ë°©ì§€ | êµì‚¬Aê°€ ì´ë¯¸ í•™ê¸‰ 1-1 ìˆ˜ì—… ì¤‘ |
| `"ê°™ì€ êµì‚¬"` | êµì‚¬ ìì‹ ê³¼ì˜ êµì²´ ë°©ì§€ | Aêµì‚¬ê°€ ìì‹ ì˜ ì‹œê°„ê³¼ êµì²´ |
| `"êµì²´ë¶ˆê°€"` | ê´€ë¦¬ìê°€ ì§ì ‘ ì„¤ì •í•œ êµì²´ ë¶ˆê°€ | íŠ¹ë³„í•œ ìƒí™©ìœ¼ë¡œ êµì²´ ê¸ˆì§€ |
| `"ë¹ˆ ì‹œê°„"` | ì‹¤ì œ ìˆ˜ì—…ì´ ì—†ëŠ” ì‹œê°„ | ê³¼ëª©ì´ë‚˜ í•™ê¸‰ ì •ë³´ ì—†ëŠ” ìŠ¬ë¡¯ |

### êµì²´ ë¶ˆê°€ ì…€ ì„¤ì •/í•´ì œ ê³¼ì •

```dart
class NonExchangeableManager {
  /// êµì²´ ë¶ˆê°€ ì…€ë¡œ ì„¤ì •
  void setNonExchangeable(String teacherName, String day, int period, String reason) {
    TimeSlot slot = _getTimeSlot(teacherName, day, period);
    slot.setExchangeBlockReason(reason);
    
    AppLogger.exchangeDebug('êµì²´ ë¶ˆê°€ ì„¤ì •: êµì‚¬ëª… $day${period}êµì‹œ - $reason');
  }
  
  /// êµì²´ ë¶ˆê°€ í•´ì œ  
  void clearNonExchangeable(String teacherName, String day, int period) {
    TimeSlot slot = _getTimeSlot(teacherName, day, period);
    slot.isExchangeable = true;
    slot.exchangeReason = null;
    
    AppLogger.exchangeDebug('êµì²´ ë¶ˆê°€ í•´ì œ: êµì‚¬ëª… $day${period}êµì‹œ');
  }
}
```

---

## êµì²´ ìœ í˜•ë³„ ê²€ì¦ ê³¼ì •

### 1. 1:1 êµì²´ ê²€ì¦ (ì–‘ë°©í–¥)

#### êµ¬ì¡°
```
êµì‚¬A |ì›”ìš”ì¼|2êµì‹œ|í•™ê¸‰1-3|ìˆ˜í•™  â‡„  êµì‚¬B |í™”ìš”ì¼|1êµì‹œ|í•™ê¸‰1-3|ì‚¬íšŒ
```

#### ê²€ì¦ í¬ì¸íŠ¸
1. **êµì‚¬A â†’ êµì‚¬B ì‹œê°„ëŒ€ë¡œ ì´ë™**
   - êµì‚¬Aê°€ í™”ìš”ì¼ 1êµì‹œì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
   
2. **êµì‚¬B â†’ êµì‚¬A ì‹œê°„ëŒ€ë¡œ ì´ë™**  
   - êµì‚¬Bê°€ ì›”ìš”ì¼ 2êµì‹œì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸

#### ì½”ë“œ êµ¬í˜„
```dart
bool _checkExchangeableConflict(
  String teacherName, 
  String selectedTeacher, 
  String teacherDay, 
  int teacherPeriod,
  String selectedDay, 
  int selectedPeriod,
  List<TimeSlot> timeSlots
) {
  // 1. êµì‚¬ê°€ ì„ íƒëœ êµì‚¬ì˜ ì‹œê°„ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€ ê²€ì¦
  bool teacherCanMoveToSelected = !_nonExchangeableManager.isNonExchangeableTimeSlot(
    teacherName, selectedDay, selectedPeriod);
  
  // 2. ì„ íƒëœ êµì‚¬ê°€ êµì‚¬ì˜ ì›ë˜ ì‹œê°„ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€ ê²€ì¦
  bool selectedCanMoveToTeacher = !_nonExchangeableManager.isNonExchangeableTimeSlot(
    selectedTeacher, teacherDay, teacherPeriod);
  
  // ì–‘ë°©í–¥ ëª¨ë‘ ê°€ëŠ¥í•´ì•¼ êµì²´ ì„±ê³µ
  return teacherCanMoveToSelected && selectedCanMoveToTeacher;
}
```

### 2. ìˆœí™˜êµì²´ ê²€ì¦ (ì›í˜• êµ¬ì¡°)

#### êµ¬ì¡°  
```
êµì‚¬A â†’ êµì‚¬B â†’ êµì‚¬C â†’ êµì‚¬A (ì›í˜• ìˆœí™˜)
```

#### ê²€ì¦ í¬ì¸íŠ¸
1. **êµì‚¬A â†’ êµì‚¬B ì‹œê°„ëŒ€ë¡œ ì´ë™**
   - êµì‚¬Aê°€ êµì‚¬Bì˜ ì‹œê°„ëŒ€ì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
   
2. **êµì‚¬B â†’ êµì‚¬C ì‹œê°„ëŒ€ë¡œ ì´ë™**
   - êµì‚¬Bê°€ êµì‚¬Cì˜ ì‹œê°„ëŒ€ì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸
   
3. **êµì‚¬C â†’ êµì‚¬A ì‹œê°„ëŒ€ë¡œ ì´ë™**
   - êµì‚¬Cê°€ êµì‚¬Aì˜ ì‹œê°„ëŒ€ì— êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ”ì§€ í™•ì¸

#### ì½”ë“œ êµ¬í˜„
```dart
bool _isOneWayExchangeableOptimized(ExchangeNode from, ExchangeNode to, List<TimeSlot> timeSlots) {
  // êµì‚¬ê°€ ëª©ì ì§€ ì‹œê°„ì— ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
  bool fromEmptyAtToTime = _checkTeacherAvailabilityAtTime([from.teacherName], to.dayNumber, to.period, timeSlots);
  
  // ê°™ì€ í•™ê¸‰ì¸ì§€ í™•ì¸
  bool sameClass = from.className == to.className;
  
  // êµì²´ ë¶ˆê°€ ì¶©ëŒ ê²€ì¦ ì¶”ê°€
  bool noExchangeableConflict = !_isNonExchangeableClash(from.teacherName, to.day, to.period);
  
  return fromEmptyAtToTime && sameClass && noExchangeableConflict;
}
```

### 3. ì—°ì‡„êµì²´ ê²€ì¦ (2ë‹¨ê³„ ì—°ì‡„)

#### êµ¬ì¡°
```
1ë‹¨ê³„: ë…¸ë“œ1 â†” ë…¸ë“œ2 (ë¹ˆ ì‹œê°„ ë§Œë“¤ê¸°)
2ë‹¨ê³„: ë…¸ë“œA â†” ë…¸ë“œB (ìµœì¢… êµì²´)
```

#### ê²€ì¦ í¬ì¸íŠ¸

**1ë‹¨ê³„ ê²€ì¦:**
1. ë…¸ë“œ1 êµì‚¬ â†’ ë…¸ë“œ2 ì‹œê°„ëŒ€ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€
2. ë…¸ë“œ2 êµì‚¬ â†’ ë…¸ë“œ1 ì‹œê°„ëŒ€ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€

**2ë‹¨ê³„ ê²€ì¦:**  
1. ë…¸ë“œA êµì‚¬ â†’ ë…¸ë“œB ì‹œê°„ëŒ€ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€ (ë…¸ë“œ2ê°€ ë¹„ì›Œì§„ í›„)
2. ë…¸ë“œB êµì‚¬ â†’ ë…¸ë“œA ì‹œê°„ëŒ€ë¡œ ì´ë™ ê°€ëŠ¥í•œì§€

#### ì½”ë“œ êµ¬í˜„
```dart
// 1ë‹¨ê³„ ì§ì ‘ êµì²´ ê°€ëŠ¥ì„± í™•ì¸
bool _canDirectExchange(ExchangeNode node1, ExchangeNode node2, List<TimeSlot> timeSlots) {
  bool teacher1EmptyAtNode2Time = !_findTimeSlotConflict(node1.teacherName, node2.dayNumber, node2.period, timeSlots);
  bool teacher2EmptyAtNode1Time = !_findTimeSlotConflict(node2.teacherName, node1.dayNumber, node1.period, timeSlots);
  bool sameClass = node1.className == node2.className;
  
  // êµì²´ ë¶ˆê°€ ì¶©ëŒ ê²€ì¦ ì¶”ê°€
  bool teacher1CanMoveToNode2 = !_isNonExchangeableClash(node1.teacherName, node2.day, node2.period);
  bool teacher2CanMoveToNode1 = !_isNonExchangeableClash(node2.teacherName, node1.day, node1.period);
  
  return teacher1EmptyAtNode2Time && teacher2EmptyAtNode1Time && sameClass && teacher1CanMoveToNode2 && teacher2CanMoveToNode1;
}

// 2ë‹¨ê³„ êµì²´ í›„ ê°€ëŠ¥ì„± í™•ì¸
bool _canExchangeAfterClearing(ExchangeNode nodeA, ExchangeNode nodeB, ExchangeNode node2, List<TimeSlot> timeSlots) {
  bool teacherAEmptyAtBTime = !_findTimeSlotConflict(nodeA.teacherName, nodeB.dayNumber, nodeB.period, timeSlots);
  bool teacherBEmptyAtATime = !_findTimeSlotConflict(nodeB.teacherName, nodeA.dayNumber, nodeA.period, timeSlots);
  bool sameClass = nodeA.className == nodeB.className;
  
  // êµì²´ ë¶ˆê°€ ì¶©ëŒ ê²€ì¦ ì¶”ê°€ 
  bool teacherACanMoveToB = !_isNonExchangeableClash(nodeA.teacherName, nodeB.day, nodeB.period);
  bool teacherBCanMoveToA = !_isNonExchangeableClash(nodeB.teacherName, nodeA.day, nodeA.period);
  
  return teacherAEmptyAtBTime && teacherBEmptyAtATime && sameClass && teacherACanMoveToB && teacherBCanMoveToA;
}
```

---

## ê²€ì¦ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

### ê³µí†µ ê²€ì¦ ë©”íƒ€ íŒ¨í„´

ê° êµì²´ ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³µí†µ íŒ¨í„´ì„ ë”°ë¥¸ë‹¤:

```dart
// 1. NonExchangeableManager ì´ˆê¸°í™”
final NonExchangeableManager _nonExchangeableManager = NonExchangeableManager();

// 2. ì‹œê°„í‘œ ë°ì´í„° ì„¤ì •
void findExchangePaths(List<TimeSlot> timeSlots, List<Teacher> teachers) {
  _nonExchangeableManager.setTimeSlots(timeSlots);
  // êµì²´ ê²½ë¡œ íƒìƒ‰ ë¡œì§...
}

// 3. êµì²´ ë¶ˆê°€ ì¶©ëŒ ê²€ì¦ í—¬í¼ ë©”ì„œë“œ
bool _isNonExchangeableClash(String teacherName, String day, int period) {
  return _nonExchangeableManager.isNonExchangeableTimeSlot(teacherName, day, period);
}
```

### ê²½ë¡œ í•„í„°ë§ ê³¼ì •

1. **ê²½ë¡œ ìƒì„± ì‹œì ì— ê²€ì¦ ì ìš©**
   - êµì²´ ê°€ëŠ¥í•œ ê²½ë¡œë§Œ ìƒì„±í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨
   - êµì²´ ë¶ˆê°€ëŠ¥í•œ ê²½ë¡œëŠ” ìƒì„± ë‹¨ê³„ ë¬´ì‹œ

2. **UI ë…¸ì¶œ ì›ì¹™**
   - ìœ íš¨í•œ ê²½ë¡œë§Œ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
   - êµì²´ ë¶ˆê°€ëŠ¥í•œ ê²½ë¡œëŠ” ë³´ì´ì§€ë„ ì•ŠìŒ

3. **ì„ íƒ í›„ ê²€ì¦**
   - ì‚¬ìš©ìê°€ ê²½ë¡œë¥¼ ì„ íƒí–ˆì„ ë•Œ ìµœì¢… ê²€ì¦
   - ê²½ë¡œê°€ ì—¬ì „íˆ ìœ íš¨í•œì§€ ì¬í™•ì¸

### ë¡œê¹… ì‹œìŠ¤í…œ

```dart
AppLogger.exchangeDebug('1:1êµì²´ ì–‘ë°©í–¥ ê²€ì¦: '
  '$teacherNameâ†’$selectedTeacher($selectedDay${selectedPeriod}êµì‹œ): $teacherCanMoveToSelected, '
  '$selectedTeacherâ†’$teacherName($teacherDay${teacherPeriod}êµì‹œ): $selectedCanMoveToTeacher');

AppLogger.exchangeDebug('ìˆœí™˜êµì²´ ê²½ë¡œ ê²€ì¦: '
  '$fromTeacherâ†’$toTeacher($toDay${toPeriod}êµì‹œ): $isValid');

AppLogger.exchangeDebug('ì—°ì‡„êµì²´ 2ë‹¨ê³„ ê²€ì¦ ì™„ë£Œ: '
  '1ë‹¨ê³„(${node1.id}â†”${node2.id}) + 2ë‹¨ê³„(${nodeA.id}â†”${nodeB.id})');
```

---

## ì„±ëŠ¥ ë° ìµœì í™”

### ê²€ì¦ ì„±ëŠ¥ ë¶„ì„

| êµì²´ ìœ í˜• | ê²€ì¦ ë³µì¡ë„ | ì¼ë°˜ í•™êµ í™˜ê²½ | ìµœì í™” í›„ |
|----------|-------------|---------------|-----------|
| **1:1 êµì²´** | O(N) | ~50ms | ~3ms |
| **ìˆœí™˜êµì²´** | O(N^S) | ~500ms (3ë‹¨ê³„) | ~13ms |
| **ì—°ì‡„êµì²´** | O(TÂ³/N) | ~1.7ì“° | ~3ms |

### ìµœì í™” ê¸°ë²•

#### 1. ì¸ë±ìŠ¤ ê¸°ë°˜ ì¡°íšŒ
```dart
class OptimizedNonExchangeableManager {
  Map<String, Set<String>> _teacherTimeIndex = {};
  
  void buildIndexes(List<TimeSlot> timeSlots) {
    for (TimeSlot slot in timeSlots) {
      if (slot.teacher != null && slot.dayOfWeek != null && slot.period != null) {
        String key = '${slot.teacher}_${slot.dayOfWeek}_${slot.period}';
        if (!slot.isExchangeable) {
          _teacherTimeIndex[key] = 'nonExchangeable';
        }
      }
    }
  }
  
  bool isNonExchangeableCached(String teacherName, String Ğ´ĞµĞ½ÑŒ, int period) {
    String key = '${teacherName}_${DayUtils.getDayNumber(day)}_$period';
    return _teacherTimeIndex.containsKey(key);
  }
}
```

#### 2. ìºì‹± ë©”ì»¤ë‹ˆì¦˜
```dart
Map<String, bool> _exchangeabilityCache = {};

bool _isNonExchangeableCached(ExchangeNode from, ExchangeNode to) {
  String cacheKey = '${from.teacherName}_${to.dayNumber}_${to.period}';
  
  return _exchangeabilityCache[cacheKey] ??= 
    _nonExchangeableManager.isNonExchangeableTimeSlot(from.teacherName, to.day, to.period);
}
```

#### 3. ì¡°ê¸° ì¢…ë£Œ ì „ëµ
```dart
bool _validateExchangePathOptimized(List<ExchangeNode> path) {
  for (int i = 0; i < path.length - 1; i++) {
    ExchangeNode from = path[i];
    ExchangeNode to = path[i + 1];
    
    // ì¡°ê¸° ì¢…ë£Œ: í•œ ë²ˆì´ë¼ë„ êµì²´ ë¶ˆê°€ëŠ¥í•˜ë©´ ì¦‰ì‹œ false ë°˜í™˜
    if (_isNonExchangeableClash(from.teacherName, to.day, to.period)) {
      AppLogger.exchangeDebug('ì¡°ê¸° ì¢…ë£Œ: ${from.id} â†’ ${to.id} êµì²´ ë¶ˆê°€');
      return false;
    }
  }
  return true;
}
```

### ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬

```dart
// ë³µì¡í•œ êµì²´ ê²½ë¡œ íƒìƒ‰ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬
Future<List<ExchangePath>> findExchangePathsAsync(
  List<TimeSlot> timeSlots,
  List<Teacher> teachers,
) async {
  // UI ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°©ì§€ë¥¼ ìœ„í•´ ë³„ë„ isolate ì‚¬ìš©
  return await compute(_findExchangePathsInBackground, {
    'timeSlots': timeSlots,
    'teachers': teachers,
  });
}

List<ExchangePath> _findExchangePathsInBackground(Map<String, dynamic> params) {
  List<TimeSlot> timeSlots = params['timeSlots'];
  List<Teacher> teachers = params['teachers'];
  
  // ë°±ê·¸ë¼ìš´ë“œì—ì„œ êµì²´ ê²½ë¡œ íƒìƒ‰ ë° ê²€ì¦
  return _findValidExchangePaths(timeSlots, teachers);
}
```

---

## ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: êµì²´ ë¶ˆê°€ ì…€ì´ ìˆëŠ” ê²½ìš°

```
ì‹œê°„í‘œ ìƒíƒœ:
Aêµì‚¬ |ì›”|2êµì‹œ|1-3|ìˆ˜í•™ âœ“êµì²´ê°€ëŠ¥
Bêµì‚¬ |ì›”|4êµì‹œ|1-3|ìŒì•… âœ“êµì²´ê°€ëŠ¥
Aêµì‚¬ |ì›”|4êµì‹œ|2-1|ê³¼í•™ âŒêµì²´ë¶ˆê°€ (ê°™ì€ êµì‚¬)
Bêµì‚¬ |ì›”|2êµì‹œ|1-1|êµ­ì–´ âŒêµì²´ë¶ˆê°€ (êµì²´ ë¶ˆê°€ ì„¤ì •)
```

**êµì²´ ìš”ì²­:** Aêµì‚¬ ì›” 2êµì‹œ â†” Bêµì‚¬ ì›” 4êµì‹œ

**ê²€ì¦ ê³¼ì •:**
1. Aêµì‚¬ â†’ ì›” 4êµì‹œ ì´ë™ ì‹œë„
   - Aêµì‚¬ì˜ ì›” 4êµì‹œëŠ” '2-1 ê³¼í•™' ìˆ˜ì—… âŒ êµì²´ë¶ˆê°€ (ê°™ì€ êµì‚¬)
   - ê²€ì¦ ê²°ê³¼: false âŒ

2. Bêµì‚¬ â†’ ì›” 2êµì‹œ ì´ë™ ì‹œë„  
   - Bêµì‚¬ì˜ ì›” 2êµì‹œëŠ” '1-1 êµ­ì–´' ìˆ˜ì—… âŒ êµì²´ë¶ˆê°€ ì„¤ì •ë¨
   - ê²€ì¦ ê²°ê³¼: false âŒ

**ìµœì¢… ê²°ê³¼:** êµì²´ ë¶ˆê°€ëŠ¥ - ì–‘ë°©í–¥ ëª¨ë‘ êµì²´ ë¶ˆê°€ ì…€ ì¡´ì¬

### ì‹œë‚˜ë¦¬ì˜¤ 2: ìˆœí™˜êµì²´ì—ì„œ êµì²´ ë¶ˆê°€ ì…€ ê´€ë¦¬

```
ì‹œê°„í‘œ ìƒíƒœ:
Aêµì‚¬ |ì›”|2êµì‹œ|1-3|ìˆ˜í•™ âœ“êµì²´ê°€ëŠ¥
Bêµì‚¬ |ì›”|4êµì‹œ|1-3|ìŒì•… âœ“êµì²´ê°€ëŠ¥  
Cêµì‚¬|ì›”|6êµì‹œ|1-3|ì²´ìœ¡ âœ“êµì²´ê°€ëŠ¥
Aêµì‚¬|ì›”|4êµì‹œ|1-2|ê³¼í•™ âŒêµì²´ë¶ˆê°€ (ì—°ê°•)
```

**ìˆœí™˜êµì²´ ì‹œë„:** Aêµì‚¬(ì›”2êµì‹œ) â†’ Bêµì‚¬(ì›”4êµì‹œ): â†’ Cêµì‚¬(ì›”6êµì‹œ) â†’ Aêµì‚¬(ì›”2êµì‹œ)

**ê²€ì¦ ê³¼ì •:**
1. Aêµì‚¬ â†’ Bêµì‚¬ ì›” 4êµì‹œ  
   - Aêµì‚¬ì˜ ì›” 4êµì‹œëŠ” '1-2 ê³¼í•™' âŒ êµì²´ë¶ˆê°€ (ì—°ê°•)
   - ì¦‰ê³¼ ê²°ê³¼: false âŒ

2. Bêµì‚¬ â†’ Cêµì‚¬ ì›” 6êµì‹œ
   - Bêµì‚¬ì˜ ì›” 6êµì‹œëŠ” ë¹„ì–´ìˆìŒ âœ“ êµì²´ê°€ëŠ¥
   - ê²€ì¦ ê²°ê³¼: true âœ“

3. Cêµì‚¬ â†’ Aêµì‚¬ ì›” 2êµì‹œ
   - Cêµì‚¬ì˜ ì›” 2êµì‹œëŠ” ë¹„ì–´ìˆìŒ âœ“ êµì²´ê°€ëŠ¥  
   - ê²€ì¦ ê²°ê³¼: true âœ“

**ìµœì¢… ê²°ê³¼:** ìˆœí™˜êµì²´ ë¶ˆê°€ëŠ¥ - ì²« ë²ˆì§¸ ë‹¨ê³„ì—ì„œ êµì²´ ë¶ˆê°€ ì…€ ì¡´ì¬

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì—°ì‡„êµì²´ì—ì„œ ë³µí•© ê²€ì¦

```
ì‹œê°„í‘œ ìƒíƒœ:
Aêµì‚¬ |ì›”| 2êµì‹œ|1-3|ìˆ˜í•™ (ê²°ê°• ìˆ˜ì—…)
Bêµì‚¬|í™”|1êµì‹œ|1-3|ì‚¬íšŒ (ëŒ€ì²´ í›„ë³´)  
Cêµì‚¬|ëª©|2êµì‹œ|1-3|ì˜ì–´ (1ë‹¨ê³„ í›„ë³´)
Aêµì‚¬|í™”|1êµì‹œ|1-2|ê³¼í•™ âŒêµì²´ë¶ˆê°€ (ì¤‘ìš” ì‹œí—˜)
Cêµì‚¬|ëª©|3êµì‹œ|1-1|ë¯¸ìˆ  âœ“êµì²´ê°€ëŠ¥
```

**ì—°ì‡„êµì²´ ì‹œë„:**
- A: Aêµì‚¬ ì›” 2êµì‹œ (ê²°ê°•)
- B: Bêµì‚¬ í™” 1êµì‹œ (ëŒ€ì²´ í›„ë³´)
- 1: Cêµì‚¬ ëª© 3êµì‹œ (1ë‹¨ê³„ êµì²´ í›„ë³´)
- 2: Aêµì‚¬ í™” 1êµì‹œ (Cêµì‚¬ê°€ ë¹„ì›Œì•¼ í•  ìœ„ì¹˜)

**ê²€ì¦ ê³¼ì •:**
1. **1ë‹¨ê³„ ê²€ì¦:** Cêµì‚¬ ëª© 3êµì‹œ â†” Aêµì‚¬ í™” 1êµì‹œ
   - Cêµì‚¬ â†’ Aêµì‚¬ í™” 1êµì‹œ: ì œìƒ âœ“
   - Aêµì‚¬ â†’ Cêµì‚¬ ëª© 3êµì‹œ: ì •ìƒ âœ“
   - ê²€ì¦ ê²°ê³¼: true âœ“

2. **2ë‹¨ê³„ ê²€ì¦:** Aêµì‚¬ ì›” 2êµì‹œ â†” Bêµì‚¬ í™” 1êµì‹œ (Aêµì‚¬ í™” 1êµì‹œê°€ ë¹„ì›Œì§„ í›„)
   - Aêµì‚¬ â†’ Bêµì‚¬ í™” 1êµì‹œ: âŒ êµì²´ë¶ˆê°€ (ì¤‘ìš” ì‹œí—˜)  
   - Bêµì‚¬ â†’ Aêµì‚¬ ì›” 2êµì‹œ: ì •ìƒ âœ“
   - ê²€ì¦ ê²°ê³¼: false âŒ

**ìµœì¢… ê²°ê³¼:** ì—°ì‡„êµì²´ ë¶ˆê°€ëŠ¥ - 2ë‹¨ê³„ì—ì„œ êµì²´ë¶ˆê°€ ì…€ ì¡´ì¬

---

## ë¬¸ì„œ ì—°ê³„

### ê´€ë ¨ ë¬¸ì„œ ëª©ë¡

1. **[current_exchange_systems.md](current_exchange_systems.md)**
   - í˜„ì¬ êµ¬í˜„ëœ 1:1 êµì²´ ë° ìˆœí™˜êµì²´ ì‹œìŠ¤í…œ ìƒì„¸ ë¬¸ì„œ
   - ê° ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ API ë° ì‚¬ìš©ë²• ê°€ì´ë“œ

2. **[chain_exchange_algorithm.md](chain_exchange_algorithm.md)**
   - ì—°ì‡„êµì²´ ì•Œê³ ë¦¬ì¦˜ ì „ìš© ë¬¸ì„œ
   - ì„±ëŠ¥ ë¶„ì„ ë° êµ¬í˜„ ê°€ì´ë“œ

3. **[design.md](design.md)**
   - ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ
   - ë°ì´í„° êµ¬ì¡° ë° ì„¤ê³„ ì›ì¹™

4. **[global_rules.md](global_rules.md)**
   - ê°œë°œ ê°€ì´ë“œë¼ì¸ ë° ì½”ë”© ê·œì¹™
   - Riverpod ìƒíƒœ ê´€ë¦¬ ë°©ì‹

### ë¬¸ì„œ í™œìš© ê°€ì´ë“œ

**êµì²´ ì‹œìŠ¤í…œ ì´í•´ ìˆœì„œ:**
1. ì´ ë¬¸ì„œë¡œ ì „ì²´ ê²€ì¦ ì²´ê³„ íŒŒì•…
2. `current_exchange_systems.md`ë¡œ ê° êµì²´ ìš°í˜• ìƒì„¸ í•™ìŠµ  
3. `chain_exchange_algorithm.md`ë¡œ ì—°ì‡„êµì²´ ì•Œê³ ë¦¬ì¦˜ ì‹¬í™”
4. `design.md`ë¡œ ì „ì²´ ì•„í‚¤í…ì²˜ ì´í•´
5. `global_rules.md`ë¡œ ê°œë°œ ê°€ì´ë“œë¼ì¸ í™•ì¸

**ê°œë°œìë³„ ì¶”ì²œ ë¬¸ì„œ:**
- **ë°±ì—”ë“œ ê°œë°œì**: ì´ ë¬¸ì„œ + `chain_exchange_algorithm.md` + `design.md`
- **í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì**: ì´ ë¬¸ì„œ + `current_exchange_systems.md` + `global_rules.md`
- **ì‹ ê·œ ê°œë°œì**: `global_rules.md` â†’ `design.md` â†’ ì´ ë¬¸ì„œ â†’ `current_exchange_systems.md`

---

## ê²°ë¡ 

ì´ ë¬¸ì„œëŠ” **ì‹œê°„í‘œ êµì²´ ì‹œìŠ¤í…œì˜ í†µí•© ê²€ì¦ ì²´ê³„**ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•

- âœ… **í†µí•© ê²€ì¦**: ëª¨ë“  êµì²´ ìœ í˜•(1:1, ìˆœí™˜, ì—°ì‡„)ì—ì„œ ë™ì¼í•œ ê²€ì¦ ë¡œì§ ì ìš©
- âœ… **ê²½ë¡œ í•„í„°ë§**: êµì²´ ë¶ˆê°€ëŠ¥í•œ ê²½ë¡œëŠ” ìƒì„± ë‹¨ê³„ì—ì„œ ì œì™¸
- âœ… **ì–‘ë°©í–¥ ê²€ì¦**: íŠ¹íˆ 1:1 êµì²´ì—ì„œ ì–‘ìª½ ëª¨ë‘ ê°€ëŠ¥í•´ì•¼ êµì²´ ì„±ê³µ
- âœ… **ì„±ëŠ¥ ìµœì í™”**: ì¸ë±ìŠ¤ ê¸°ë°˜ ì¡°íšŒ ë° ìºì‹±ìœ¼ë¡œ ì‹¤ì‹œê°„ ì²˜ë¦¬ ì§€ì›

### ê²€ì¦ ì •í™•ë„

| êµì²´ ìœ í˜• | ê²€ì¦ ì •í™•ë„ | ì–‘ë°©í–¥ ê²€ì¦ | ìƒíƒœ |
|---------|------------|------------|------|
| **1:1 êµì²´** | âœ… 100% ì •í™• | âœ… ì™„ì „ êµ¬í˜„ | ì™„ë£Œ |
| **é †í™˜êµì²´** | âœ… 100% ì •í™• | âœ… ì™„ì „ êµ¬í˜„ | ì™„ë£Œ |
| **ì—°ì‡„êµì²´** | âœ… 100% ì •í™• | âœ… ì™„ì „ êµ¬í˜„ | ì™„ë£Œ |

ì´ì œ ëª¨ë“  êµì²´ ìš°í˜•ì´ ì™„ë²½í•œ êµì²´ ë¶ˆê°€ ì¶©ëŒ ê²€ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤! ğŸš€